<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Agent Finance Risk Analysis</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 2.5rem;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2rem;
            color: #7f8c8d;
        }

        .form-container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .form-container h2 {
            color: #2c3e50;
            margin-bottom: 25px;
            font-size: 1.8rem;
        }

        .form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            align-items: end;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            color: #34495e;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group select {
            padding: 12px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #3498db;
        }

        .submit-btn {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
            margin-top: 10px;
        }

        .submit-btn:hover:not(:disabled) {
            transform: translateY(-2px);
        }

        .submit-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }

        .error {
            background: #ffebee;
            border: 1px solid #f44336;
            color: #c62828;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .results {
            margin-top: 30px;
            display: none;
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .card h3 {
            color: #7f8c8d;
            font-size: 0.9rem;
            margin-bottom: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .card p {
            font-size: 2rem;
            font-weight: 700;
            margin: 0;
        }

        .positive { color: #27ae60; }
        .negative { color: #e74c3c; }
        .volatility { color: #f39c12; }
        .trend { color: #3498db; text-transform: capitalize; }
        .risk-flags { color: #e67e22; }

        .report {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .report h2 {
            color: #2c3e50;
            margin-bottom: 25px;
            font-size: 1.8rem;
        }

        .markdown-content {
            line-height: 1.6;
            color: #34495e;
        }

        .markdown-content h1 {
            color: #2c3e50;
            font-size: 2rem;
            margin-bottom: 20px;
        }

        .markdown-content h2 {
            color: #2c3e50;
            font-size: 1.5rem;
            margin-top: 30px;
            margin-bottom: 15px;
        }

        .markdown-content h3 {
            color: #34495e;
            font-size: 1.2rem;
            margin-top: 20px;
            margin-bottom: 10px;
        }

        .markdown-content p {
            margin-bottom: 15px;
        }

        .markdown-content ul {
            margin-bottom: 15px;
            padding-left: 20px;
        }

        .markdown-content li {
            margin-bottom: 5px;
        }

        .markdown-content strong {
            color: #2c3e50;
        }

        .markdown-content code {
            background: #f8f9fa;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.9rem;
        }

        .markdown-content pre {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 20px 0;
        }

        .markdown-content pre code {
            background: none;
            padding: 0;
            color: inherit;
        }

        .raw-data {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        .raw-data summary {
            cursor: pointer;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .raw-data pre {
            background: white;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            font-size: 0.8rem;
            color: #34495e;
            border: 1px solid #e1e8ed;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #7f8c8d;
        }

        @media (max-width: 768px) {
            .form {
                grid-template-columns: 1fr;
            }
            .summary-cards {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>ðŸ¤– Multi-Agent Finance Risk Analysis</h1>
            <p>Powered by LangGraph & Local Ollama Qwen Model</p>
        </div>

        <!-- Input Form -->
        <div class="form-container">
            <h2>ðŸ“Š Analysis Parameters</h2>
            
            <form class="form" id="analysisForm">
                <div class="form-group">
                    <label>Stock Ticker</label>
                    <input type="text" name="ticker" value="AAPL" placeholder="e.g., AAPL, MSFT, GOOGL" required>
                </div>

                <div class="form-group">
                    <label>Time Period</label>
                    <select name="period">
                        <option value="1d">1 Day</option>
                        <option value="5d">5 Days</option>
                        <option value="1mo">1 Month</option>
                        <option value="3mo">3 Months</option>
                        <option value="6mo">6 Months</option>
                        <option value="1y">1 Year</option>
                        <option value="2y">2 Years</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Interval</label>
                    <select name="interval">
                        <option value="1m">1 Minute</option>
                        <option value="5m">5 Minutes</option>
                        <option value="15m">15 Minutes</option>
                        <option value="30m">30 Minutes</option>
                        <option value="1h">1 Hour</option>
                        <option value="1d">1 Day</option>
                        <option value="1wk">1 Week</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Risk Horizon (Days)</label>
                    <input type="number" name="horizon_days" value="30" min="1" max="365" required>
                </div>

                <button type="submit" class="submit-btn" id="submitBtn">
                    ðŸ“ˆ Analyze Stock Risk
                </button>
            </form>
        </div>

        <!-- Error Display -->
        <div class="error" id="errorDiv">
            <strong>Error:</strong> <span id="errorText"></span>
        </div>

        <!-- Loading -->
        <div class="loading" id="loadingDiv" style="display: none;">
            <h3>ðŸ¤– Analyzing with Qwen Model...</h3>
            <p>Please wait while the multi-agent system processes your request.</p>
        </div>

        <!-- Results Display -->
        <div class="results" id="resultsDiv">
            <!-- Summary Cards -->
            <div class="summary-cards" id="summaryCards">
                <!-- Will be populated by JavaScript -->
            </div>

            <!-- Detailed Report -->
            <div class="report">
                <h2>ðŸ“‹ Detailed Risk Analysis Report</h2>
                <div class="markdown-content" id="reportContent">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>

            <!-- Raw Data -->
            <details class="raw-data">
                <summary>Raw Analysis Data</summary>
                <pre id="rawData"></pre>
            </details>
        </div>
    </div>

    <script>
        document.getElementById('analysisForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const data = Object.fromEntries(formData);
            
            // Show loading, hide results and error
            document.getElementById('loadingDiv').style.display = 'block';
            document.getElementById('resultsDiv').style.display = 'none';
            document.getElementById('errorDiv').style.display = 'none';
            document.getElementById('submitBtn').disabled = true;
            document.getElementById('submitBtn').textContent = 'Analyzing...';
            
            try {
                const response = await fetch('http://localhost:5001/api/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                displayResults(result);
                
            } catch (error) {
                showError(error.message);
            } finally {
                document.getElementById('loadingDiv').style.display = 'none';
                document.getElementById('submitBtn').disabled = false;
                document.getElementById('submitBtn').textContent = 'ðŸ“ˆ Analyze Stock Risk';
            }
        });

        function displayResults(result) {
            // Show results
            document.getElementById('resultsDiv').style.display = 'block';
            
            // Update summary cards
            const summaryCards = document.getElementById('summaryCards');
            summaryCards.innerHTML = `
                <div class="card">
                    <h3>Cumulative Return</h3>
                    <p class="${result.valuation?.cumulative_return >= 0 ? 'positive' : 'negative'}">
                        ${(result.valuation?.cumulative_return * 100).toFixed(2)}%
                    </p>
                </div>
                <div class="card">
                    <h3>Annualized Volatility</h3>
                    <p class="volatility">
                        ${(result.valuation?.annualized_volatility * 100).toFixed(1)}%
                    </p>
                </div>
                <div class="card">
                    <h3>Price Trend</h3>
                    <p class="trend">${result.valuation?.price_trend || 'N/A'}</p>
                </div>
                <div class="card">
                    <h3>Risk Flags</h3>
                    <p class="risk-flags">${result.metrics?.risk_flags?.length || 0}</p>
                </div>
            `;
            
            // Update report content
            document.getElementById('reportContent').innerHTML = result.report?.markdown_report || 'No report available';
            
            // Update raw data
            document.getElementById('rawData').textContent = JSON.stringify(result, null, 2);
        }

        function showError(message) {
            document.getElementById('errorText').textContent = message;
            document.getElementById('errorDiv').style.display = 'block';
        }
    </script>
</body>
</html>
